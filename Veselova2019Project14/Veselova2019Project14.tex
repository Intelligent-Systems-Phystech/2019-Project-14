\documentclass[12pt,twosides]{article}
\usepackage{jmlda}
\usepackage{graphicx}
%\NOREVIEWERNOTES
\renewcommand*{\thefootnote}{\fnsymbol{footnote}}


\title
[Detection of tandem repeats in proteins]
{Deep Learning for reliable detection of tandem repeats in 3D protein structures.}
\author
[Веселова~Е.Р.] 
{Веселова~Е.Р.$^1$} 
% [] список авторов, выводимый в заголовок; не нужен, если он не отличается от основного
\thanks
	{Задачу поставил:  Grudinin~S.
	Консультант:  Pages G.}
\email
{veselova.er@phystech.edu}
\organization
{$^1$Московский физико-технический институт (МФТИ)}
\abstract
{В работе рассматривается не требующий предварительной обработки и аугментации входных данных алгоритм для выделения осей симметрии и повторяющихся элементов в трёхмерной структуре белка. Задачи анализа белков на наличие структурных особенностей с высокой эффективностью решаются с помощью свёрточных нейросетей. Относительно трансляции входных данных CNN обладают свойством устойчивости, или \textit{эквивариантности} --- коммутативности преобразования исходных данных и свёртки, однако для вращений данное свойство не сохраняется. Искусственно постоянство ответа нейросетей на одних и тех же данных, подвергнутых жестким (евклидовым) преобразованиям достигается аугментацией входных данных. Обеспечить эквивариантность всей нейросети без необходимости аугментации данных предлагается заменой свёрточных фильтров на линейную комбинацию трёхмерных сферических гармоник, эквивариантных относительно вращений. Решение данной задачи позволит увеличить скорость обработки белков и, гипотетически, точность выделения структурных повторений.
	
\bigskip
\textbf{Ключевые слова}: \emph {CNN, свёрточные нейросети, сферические гармоники, структурные повторения, оси симметрии, 3D объект}.}


\begin{document}
	\maketitle
	%\linenumbers
	
	\section{Введение}
	Задачи структурной биологии . Большая часть получаемых на практике белков обладает повтояющимися элементами структуры или симметрией, которые влияют на функции белков и позволяют исследовать их эволюцию. Нахождение симметрий и повторов является важной задачей, во многих формулировках уже решённой с помощью классических методов машинного обучения в 2006 году \cite{MitGuiPau06}
	При наличии точечного представления плотности 3D объекта задача определения всех типов симметрий была решена аналитически \cite{pages:hal-01779893, pages:hal-01816449}.
	Поэтому особый интерес представляет применение методов глубокого обучения и свёрточных нейросетей (CNN --- convolutional neural network), которые позволяют получать на нижних уровнях сети легко интерпретируемые характерные черты изучаемых объектов. 
	
	Предсказание трёхмерной структуры белка по его аминокислотному составу \cite{BioCNN18} и детектирование структурных повторений и внутренних симметрий с высокой точностью решается свёрточными нейросетями \cite{DeepSymmetry18}, однако существующие свёрточные нейросети не имеют возможности одинаково качественно обрабатывать входные данные при любых поворотах и сдвигах. Основная цель работы состоит в адаптации построенных нейросетей для выявления повторов и симметрий к различным преобразованиям входных данных. 
	
	Если трансляция входного объекта при обработке свёрточной нейросетью даёт пропорционально транслированную карту характеристик \cite{Lenc18}, то для вращений входного объекта подобное свойство не реализуется. Искомое свойство переноса преобразования входных данных на выходные называется эквивариантностью. Кроме того, сохраняющаяся во всех слоях нейросети эквивариантность позволяет отслеживать свойства исследуемых структур уже на нижних уровнях нейросети. 2D CNN, относительно которой данные были бы эквивариантны, была реализована заменой стандартных свёрточных фильтров на комплексные \textit{круговые гармоники} (circular harmonics), обеспечивающие вращательную эквивариантность без необходимости использовать сильную аугментацию данных \cite{conf/cvpr/WorrallGTB17}. Трёхмерной интерпретацией данного подхода являются сферические гармоники. Первоначально идея сферических гармоник была развита в моделировании для эффективного представления и определения степени схожести поверхностей трёхмерных объектов\cite{conf/siggraph/KazhdanF02, journals/cagd/MousaCAG08}. Далее идея была применена к анализу трёхмерных признаковых карт с помощью CNN. При замене стандартных трёхмерных свёрточных фильтров на линейную комбинацию аналитически определённого вращательного базиса из \textit{сферических гармоник} CNN становится эквивариантна относительно любого преобразования из группы симметрий $SE(3)$\cite{DBLP:journals/corr/abs-1807-02547}.
	
	Любое движение $g\in SE(3)$ представимо как комбинация вращения $r\in SO(3)$ и трансляции $t\in\mathbb{R}^3$. При рассмотрении одного уровня свёрточной нейросети с $K$ трёхмерных признаковых карт, соответствие между входом и выходом слоя может быть записано как $f:\mathbb{R}^3\rightarrow\mathbb{R}^K$. Оператор трансляции выходного векторного поля легко описывается как $t:(x-t)\mapsto x$. Вращение описывается более сложным образом, так как при повороте всей каждый вектор меняет свою позицию и поворачивается с помощью матрицы $\rho(r)$. Поэтому оператор вращения $\pi(r)$ определяется как $[\pi(r)f](x):=\rho(r)f(r^{-1}x)$, где $r^{-1}x$ описывает перемещение векторов на новые позиции. Таким образом, $g=tr$ представимо как $[\pi(tr)f](x):=\rho(r)f(r^{-1}(x-t))$. Обобщая полученные выкладки на CNN, выражение свёрточного фильтра между $n$ и $n+1$ слоями нейросети через базис в пространстве эквивариантных преобразований между пространствами признаков $\mathcal{F}_n$ и $\mathcal{F}_{n+1}$ позволяет гарантировать, что любое преобразование входа слоя будет давать такое же преобразование выхода, т.е. обеспечивать эквивариантность. Кроме того, в силу одинакового изменения всех трёх RGB матриц изображения при рассматриваемых преобразованиях полученное представление может быть перенесено и на цветные изображения.
	
	Именно поэтому в качестве решения поставленной задачи в статье предложена эффективная имплементация сферических гармоник в существующую CNN модель выделения тандемных повторов и симметрий в белках для получения идентичных результатов при любых вращениях исходных карт атомных плотностей белковых 3D моделей \cite{DeepSymmetry18}. В качестве входных данных выступает синтетический датасет, полученный <<симметризацией>> белковых структур датасета Top8000\footnote{ http://kinemage.biochem.duke.edu/databases/top8000.php}, состоящий из карт плотностей размеров $24\times24\times24$. 
	 
	\section{Постановка задачи}
	Данными в задаче являются $K=11$ карт атомных плотностей элементов белка. Каждая карта $\mathbf{x}_i\in\mathbb{R}^{24\times24\times24}$ обучающей выборки $\mathbf{X}$ получена искусственной симметризацией карт датасета Top8000 с порядком циклической симметрии от $1$ до $N_{order}\in[10,20]$.
	Ответом на элементе выборки $\mathbf{f}(x_i)=\mathbf{f}_i\in\mathbb{R}^{N_{order}+6}$ является композиция двух векторов $\mathbf{y}_i\in\mathbb{R}^{N_{order}}$ и $\mathbf{z}_i\in\mathbb{R}^6$, где $\mathbf{y}_i$  определяет вероятность каждого порядка симметрии, $\mathbf{z}_i$ определяет положение оси симметрии. Размерность 6 для задания оси симметрии выбрана неслучайно: модель переводит ось в трёхмерном пространстве в её представление в шестимерном пространстве посредством \textit{отображения Веронезе} $V(x,y,z)=(x^2,y^2,z^2,\sqrt2yz,\sqrt2zx,\sqrt2xy)$. 
	 
	Исходная модель $\mathbf{f(X)}$ --- свёрточная нейросеть, состоящая из двух свёрточных слоёв, имеющих по 4 фильтра каждый, и трёх полносвязных слоёв, входом для которых является конкатенация столбцов выхода второго свёрточного слоя. Зададим $\mathbf{W}\in\mathbb{R}^{n\times4\times2}$ --- матрицу коэффициентов разложения каждого из 4 фильтров двух свёрточных слоёв нейросети на $n$ базисных сферических гармоник.
	
	Функция потерь при определении порядка симметрии объекта $\mathbf{x}_i$ при известном истинном порядке $k_{t}$ с помощью вероятности каждого порядка   $P(k)=\frac{\exp(p_k)}{\sum_{j=1}^{N_{order}}\exp(p_j)}$ для вектора $\mathbf{y}_i=[p_1,\dots,p_{N_{order}}]\T$ может быть записана как
	$$L_c(\mathbf{W})=-\log(P(k_{t}))=\log\Bigg(\sum_{j=1}^{N_{order}}\exp(p_j)\Bigg)-p_{k_{t}}.$$
	Функция потерь при определении оси симметрии объекта $\mathbf{x}_i$ по известным координатам одной из точек $(x_{t},y_{t},z_{t})$ истинной оси симметрии для вектора $\mathbf{z}_i$ может быть записана как
	$$L_a(\mathbf{W})=\|\mathbf{z}_i-V(x_{t},y_{t},z_{t})\|_2.$$
	
	Получаем решаемую в процессе обучения задачу оптимизации
	$$\mathbf{W}^*=\argmin_{\textbf{W}}\big(L_c(\mathbf{W})+L_a(\mathbf{W})\big)$$
	
	\section{Особенности задачи}
	
	Требуется адаптировать модель $\mathbf{f(X, W)}$ так, что при воздействии на исходные данные любым оператором $\pi(tr)$ трансляции $t$ и вращения $r$ реализуется свойство эквивариантности, т.е.
	$$\mathbf{f}(\pi(tr)\mathbf{X,W)}=[\pi(tr)\mathbf{f}]\mathbf{(X,W)}.$$ Большинство функций активации, обрабатывающих выход свёрточного слоя, заранее не обладают эквивариантностью.
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\textwidth]{images/harmonics_for_012.pdf}
		\caption{сферические гармоники 0, 1 и 2 порядков}
	\end{figure}
	
	\section{Базовый эксперимент}
	С целью проверки наличия эквивариантности у нейросети, построенной из сферических свёрточных фильтров с учетом ограничений на нелинейную активацию, был проведён базовый эксперимент по реализации структуры базовой нейросети из работы \cite{DeepSymmetry18} с применением свёрточных слоёв из модуля se3cnn \cite{DBLP:journals/corr/abs-1807-02547}. Базовая архитектура была переработана с учётом требований модуля и необходимого порядка сферических гармоник. Согласно эмпирическим данным, достаточно второго--третьего порядков сферических для проявления эквивариантности в структуре, поэтому свёрточный фильтр в конволюционном слое представляет из себя комбинацию трёх наборов сферических функций порядков 0, 1 и 2 с двумя наборами коэффициентов разложения для каждого из наборов. Таким образом, выход конволюционного слоя имеет $2*\big((2*0+1)+(2*1+1)+(2*2+1)\big)=18$ карт. 
	Синтетические данные для обучения тестовой сети представляют из себя 400 симметричных с порядком 3 относительно любой из главных диагоналей матриц. Выходом для тестовой сети является заданная тремя координатами ось симметрии.
	
	\vspace{5mm}
	\begin{tabular}{c|c|c|c|c}
		Layer & Type & Input dimensions & Output dimensions & Parameters\\
		\hline
		1 & SE3Convolution & $24\times24\times24\times1$ & $21\times21\times21\times18$ &  Size 4, stride 1\\
		2 & Average pooling & $21\times21\times21\times18$ & $8\times8\times8\times7$ &  Size 2, stride 2\\
		\hline
		5 & Reshape & $8\times8\times8\times7$ & 1512 & \\
		6 & Linear &  1512 & 800 & \\
		7 & LeakyReLU &  800 & 800 & \\
		8 & Linear &  800 & 3 & \\
	\end{tabular}

	По результатам эксперимента наблюдается постоянство ответов при вращениях на $90^{\deg}$ и $120^{\deg}$. Для повышения выделяемых порядков симметрии требуется применение и комбинация слоёв сферических гармоник более высоких порядков вплоть до порядка $20$, максимального в нашей постановке задачи.
	
	\section{Вычислительный эксперимент}
	
	Для проведения основного вычислительного эксперимента была построена ResNet (Residual Network) архитектура \cite{DBLP:journals/corr/HeZRS15}, эффективно используемая в обработке изображений ($3.08\%$ ошибка в Imagenet Recognition challenge) \cite{DBLP:journals/corr/ZagoruykoK16}.Особенностью данной архитектуры является добавление промежуточных связей между слоями --- shortcut connections, передающих неизменное входное значение слоя. Выход последовательности слоёв, соединённых shortcut connection, представим в виде $\mathbf{X}\mapsto\mathbf{f(X)+X}$ в отличие от стандартной последовательной архитектуры $\mathbf{X}\mapsto\mathbf{f(X)}$.
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\textwidth]{images/resnet.pdf}
		\caption{структура ResNet}
	\end{figure}

	Выбор данной архитектуры в первую очередь обусловлен лучшей устойчивостью к переобучению по сравнению с последовательной нейронной сетью. Согласно математическому представлению архитектуры, каждая последовательность слоёв, соединенная shortcut connection, учится предсказывать разность между входом и выходом. Обычная архитектура не позволяет весам слоя полностью обнулиться без потери возможности обратного распространения ошибки в сети. В ResNet--архитектуре допустима последовательность слоёв с нулевыми коэфффициентами --- данная последовательность является тождественным преобразованием $\mathbf{X}\mapsto\mathbf{X}$. 
	Аналогично первым статьям, исследующим residual--метод, было решено использовать связи через один свёрточный слой \cite{DBLP:journals/corr/HeZRS15, DBLP:journals/corr/VeitWB16}.


	\bibliographystyle{plain}
	\bibliography{Veselova2019Project14}
	
\end{document}
